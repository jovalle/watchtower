services:
  watchtower:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/jovalle/watchtower:${DOCKER_TAG:-latest}
    container_name: watchtower
    restart: unless-stopped
    ports:
      - "${PORT:-9001}:9001"
    environment:
      - NODE_ENV=production
      - PORT=9001
      - SESSION_SECRET=${SESSION_SECRET:?"Please set SESSION_SECRET environment variable"}
      - PLEX_SERVER_URL=${PLEX_SERVER_URL:-http://plex:32400}
      - PLEX_TOKEN=${PLEX_TOKEN:?"Please set PLEX_TOKEN environment variable"}
      - PLEX_CLIENT_ID=${PLEX_CLIENT_ID:-watchtower-001}
      # Optional: TMDB API key for recommendations (leave empty to disable)
      - TMDB_API_KEY=${TMDB_API_KEY:-}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9001/"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
